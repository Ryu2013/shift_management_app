<% content_for :title, t(".title") %>

<%= link_to team_client_shifts_path(@office.teams.first, @office.clients.first) do %>
 <%= image_tag "back-btn.png", alt: t(".shifts"), class: "back-image" %>
<% end %>

<h1><%= t(".heading") %></h1>

<div class="flexbox">
  <div class="toggle-switch">
    <%= link_to teams_path, class: "toggle-selected" do %>
      部署
    <% end %>

    <%= link_to edit_office_path(@office), class: "toggle-selected active" do %>
      会社
    <% end %>
  </div>
</div>

<% if @office.subscription_status == 'active' %>

  <div class="card">
   <h3>契約状況</h3>
  
    <% if @office.cancel_at_period_end? %>
      <div style="background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 1em; border-radius: 4px; margin-bottom: 1em;">
        <p><strong>⚠️ 解約予約済みです</strong></p>
        <p style="margin-top: 0.5em;">
          <%= @office.current_period_end.strftime('%Y年%m月%d日') %> までご利用いただけます。<br>
          その後、自動的に解約されます。
        </p>
      </div>

    <% else %>
      <div style="background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 1em; border-radius: 4px; margin-bottom: 1em;">
        <p><strong>✅ 契約中（自動更新）</strong></p>
        <p style="margin-top: 0.5em;">
          次回更新日: <%= @office.current_period_end.strftime('%Y年%m月%d日') %>
        </p>
      </div>
    <% end %>

      <div class="flexbox" style="margin-top: 1.5rem;">
      <%= button_to "契約内容の確認・変更・解約", 
          subscriptions_portal_path, 
          method: :post, 
          data: { turbo: false }, 
          class: "flex-btn", # 独自の汎用ボタンスタイルを適用
          style: "width: auto; padding-left: 1.5em; padding-right: 1.5em;" # 少し横幅を広げる調整
      %>
    </div>
  </div>

<% elsif @office.subscription_status == 'canceled' %>
  <div class="card">
  <h3>契約状況</h3>
    <div style="background-color: #f8f9fa; border: 1px solid #dae0e5; color: #383d41; padding: 1em; border-radius: 4px; margin-bottom: 1em;">
      <p>現在は解約済みです。</p>
    </div>

    <div class="flexbox" style="margin-top: 1.5rem;">
    <%= button_to "契約内容の確認・変更・解約", 
        subscriptions_portal_path, 
        method: :post, 
        data: { turbo: false }, 
        class: "flex-btn", # 独自の汎用ボタンスタイルを適用
        style: "width: auto; padding-left: 1.5em; padding-right: 1.5em;" # 少し横幅を広げる調整
    %>
    </div>
  </div>
<% end %>

<%= render "form", office: @office %>
